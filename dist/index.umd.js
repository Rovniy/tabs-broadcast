(function(i,e){typeof exports=="object"&&typeof module<"u"?module.exports=e():typeof define=="function"&&define.amd?define(e):(i=typeof globalThis<"u"?globalThis:i||self).TabsBroadcast=e()})(this,function(){"use strict";var E=Object.defineProperty;var _=(i,e,s)=>e in i?E(i,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):i[e]=s;var w=(i,e,s)=>(_(i,typeof e!="symbol"?e+"":e,s),s),I=(i,e,s)=>{if(!e.has(i))throw TypeError("Cannot "+s)};var r=(i,e,s)=>(I(i,e,"read from private field"),s?s.call(i):e.get(i)),d=(i,e,s)=>{if(e.has(i))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(i):e.set(i,s)},h=(i,e,s,y)=>(I(i,e,"write to private field"),y?y.call(i,s):e.set(i,s),s);var S=(i,e,s)=>(I(i,e,"access private method"),s);var n,c,p,b,u,f,o,T,P,g,C;const i={channelName:"xploit_tab_channel",listenOwnChannel:!0,emitByPrimaryOnly:!0,onBecomePrimary:()=>{},onTabsUpdate:()=>{}},e={tab_prefix:"xploit_tab_id_",slave:"xploit_slave",primary:"xploit_primary",primaryTabId:"xploit_primary_tab_id",primaryStatusChanged:"XPLOIT_TAB_STATUS_CHANGED"};class s{constructor(){w(this,"tabId");this.tabId=e.tab_prefix+Date.now().toString(),this.init()}init(){typeof window>"u"||(window.addEventListener("load",()=>{localStorage.getItem(e.primaryTabId)?this.setSlaveTab(this.tabId):this.setPrimaryTab(this.tabId),this.notifyTabStatus()}),window.addEventListener("beforeunload",()=>{this.isPrimaryTab()&&this.transferPrimaryStatus(),this.removeTabStatus(this.tabId)}),window.addEventListener("storage",t=>{t.key===e.primaryTabId&&this.notifyTabStatus()}))}set(t,a){localStorage.setItem(t,a)}get(t){return localStorage.getItem(t)}remove(t){localStorage.removeItem(t)}setPrimaryTab(t){this.set(e.primaryTabId,t),this.set(t,e.primary)}setSlaveTab(t){this.set(t,e.slave)}transferPrimaryStatus(){const t=Object.keys(localStorage).filter(a=>a!==e.primaryTabId&&this.get(a)===e.slave);t.length>0?this.setPrimaryTab(t[0]):this.remove(e.primaryTabId)}removeTabStatus(t){this.remove(t)}notifyTabStatus(){if(typeof window>"u")return;const t={detail:{tabId:this.tabId,isPrimary:this.isPrimaryTab()}};window.dispatchEvent(new CustomEvent(e.primaryStatusChanged,t))}isPrimaryTab(){return this.get(e.primaryTabId)===this.tabId}}const m=class m{constructor(t=null){d(this,T);d(this,g);d(this,n,void 0);d(this,c,void 0);d(this,p,void 0);d(this,b,void 0);d(this,u,void 0);d(this,f,void 0);d(this,o,void 0);if(m.instance)return m.instance;this.setConfig(t),S(this,T,P).call(this),m.instance=this}on(t,a){r(this,n).push({type:t,callback:a})}onList(t){t.length&&t.forEach(([a,l])=>{a&&l&&r(this,n).push({type:a,callback:l})})}once(t,a){r(this,n).push({type:t,callback:a,toRemove:!0})}onceList(t){t.length&&t.forEach(([a,l])=>{a&&l&&r(this,n).push({type:a,callback:l,toRemove:!0})})}off(t){h(this,n,r(this,n).filter(a=>a.type!==t))}emit(t,a=null){if(r(this,u)&&!this.isPrimary()||!r(this,o))return;const l={type:t,payload:a};r(this,o).postMessage(l),r(this,p)&&r(this,o).onmessage({data:l})}isPrimary(){return r(this,f).isPrimaryTab()}setConfig(t){const a={...i,...t};h(this,n,[]),h(this,c,a.channelName),h(this,p,a.listenOwnChannel),h(this,b,a.onBecomePrimary),h(this,u,a.emitByPrimaryOnly)}destroy(){r(this,o)&&r(this,o).close(),m.instance=null,h(this,o,null)}};n=new WeakMap,c=new WeakMap,p=new WeakMap,b=new WeakMap,u=new WeakMap,f=new WeakMap,o=new WeakMap,T=new WeakSet,P=function(){window&&(h(this,f,new s),h(this,o,new BroadcastChannel(r(this,c))),r(this,o).onmessage=t=>{const{type:a,payload:l}=t.data;h(this,n,r(this,n).filter(v=>v.type!==a||(v.callback(l),!v.toRemove)))},r(this,o).onmessageerror=t=>{process.env.NODE_ENV!=="production"&&console.error("Can't parse message",t)},S(this,g,C).call(this))},g=new WeakSet,C=function(){window.addEventListener(e.primaryStatusChanged,t=>{const a=t;this.isPrimary()&&r(this,b).call(this,a.detail)},{passive:!0})},w(m,"instance");let y=m;return y});
//# sourceMappingURL=index.umd.js.map
