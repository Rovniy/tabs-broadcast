(function(a,e){typeof exports=="object"&&typeof module<"u"?module.exports=e():typeof define=="function"&&define.amd?define(e):(a=typeof globalThis<"u"?globalThis:a||self).TabsBroadcast=e()})(this,function(){"use strict";var C=Object.defineProperty;var _=(a,e,s)=>e in a?C(a,e,{enumerable:!0,configurable:!0,writable:!0,value:s}):a[e]=s;var w=(a,e,s)=>(_(a,typeof e!="symbol"?e+"":e,s),s),S=(a,e,s)=>{if(!e.has(a))throw TypeError("Cannot "+s)};var r=(a,e,s)=>(S(a,e,"read from private field"),s?s.call(a):e.get(a)),l=(a,e,s)=>{if(e.has(a))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(a):e.set(a,s)},h=(a,e,s,m)=>(S(a,e,"write to private field"),m?m.call(a,s):e.set(a,s),s);var I=(a,e,s)=>(S(a,e,"access private method"),s);var n,y,p,b,u,f,o,T,P,g,E;const a={channelName:"xploit_tab_channel",listenOwnChannel:!0,emitByPrimaryOnly:!0,onBecomePrimary:()=>{}},e={tab_prefix:"xploit_tab_id_",slave:"xploit_slave",primary:"xploit_primary",primaryTabId:"xploit_primary_tab_id",primaryStatusChanged:"XPLOIT_TAB_STATUS_CHANGED"};class s{constructor(){w(this,"tabId");this.tabId=e.tab_prefix+Date.now().toString(),this.init()}init(){if(typeof window>"u")return;const t=()=>{localStorage.getItem(e.primaryTabId)?this.setSlaveTab(this.tabId):this.setPrimaryTab(this.tabId),this.notifyTabStatus()};document.readyState==="complete"?t():window.addEventListener("load",t),window.addEventListener("beforeunload",()=>{this.isPrimaryTab()&&this.transferPrimaryStatus(),this.removeTabStatus(this.tabId),this.isPrimaryTab()&&this.removeTabStatus(e.primaryTabId)}),window.addEventListener("storage",i=>{i.key===e.primaryTabId&&this.notifyTabStatus()})}set(t,i){localStorage.setItem(t,i)}get(t){return localStorage.getItem(t)}remove(t){localStorage.removeItem(t)}setPrimaryTab(t){this.set(e.primaryTabId,t),this.set(t,e.primary)}setSlaveTab(t){this.set(t,e.slave)}transferPrimaryStatus(){const t=Object.keys(localStorage).filter(i=>i!==e.primaryTabId&&this.get(i)===e.slave);t.length>0?this.setPrimaryTab(t[0]):this.remove(e.primaryTabId)}removeTabStatus(t){this.remove(t)}notifyTabStatus(){if(typeof window>"u")return;const t={detail:{tabId:this.tabId,isPrimary:this.isPrimaryTab()}};window.dispatchEvent(new CustomEvent(e.primaryStatusChanged,t))}isPrimaryTab(){return this.get(e.primaryTabId)===this.tabId}}const c=class c{constructor(t=null){l(this,T);l(this,g);l(this,n,void 0);l(this,y,void 0);l(this,p,void 0);l(this,b,void 0);l(this,u,void 0);l(this,f,void 0);l(this,o,void 0);if(c.instance)return c.instance;this.setConfig(t),I(this,T,P).call(this),c.instance=this}on(t,i){r(this,n).push({type:t,callback:i})}onList(t){t.length&&t.forEach(([i,d])=>{i&&d&&r(this,n).push({type:i,callback:d})})}once(t,i){r(this,n).push({type:t,callback:i,once:!0})}onceList(t){t.length&&t.forEach(([i,d])=>{i&&d&&r(this,n).push({type:i,callback:d,once:!0})})}off(t){h(this,n,r(this,n).filter(i=>i.type!==t))}emit(t,i=null){if(r(this,u)&&!this.isPrimary()||!r(this,o))return;const d={type:t,payload:i};r(this,o).postMessage(d),r(this,p)&&r(this,o).onmessage({data:d})}isPrimary(){return r(this,f).isPrimaryTab()}setConfig(t){const i={...a,...t};h(this,n,[]),h(this,y,i.channelName),h(this,p,i.listenOwnChannel),h(this,b,i.onBecomePrimary),h(this,u,i.emitByPrimaryOnly)}destroy(){r(this,o)&&r(this,o).close(),c.instance=null,h(this,o,null)}getEvents(){return[...r(this,n)]}};n=new WeakMap,y=new WeakMap,p=new WeakMap,b=new WeakMap,u=new WeakMap,f=new WeakMap,o=new WeakMap,T=new WeakSet,P=function(){window&&(h(this,f,new s),h(this,o,new BroadcastChannel(r(this,y))),r(this,o).onmessage=t=>{const{type:i,payload:d}=t.data;h(this,n,r(this,n).filter(v=>v.type!==i||(v.callback(t.data),!v.once)))},r(this,o).onmessageerror=t=>{process.env.NODE_ENV!=="production"&&console.error("Can't parse message",t)},I(this,g,E).call(this))},g=new WeakSet,E=function(){window.addEventListener(e.primaryStatusChanged,t=>{const i=t;this.isPrimary()&&r(this,b).call(this,i.detail)},{passive:!0})},w(c,"instance");let m=c;return m});
//# sourceMappingURL=index.umd.js.map
