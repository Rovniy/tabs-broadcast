(function(s,e){typeof exports=="object"&&typeof module<"u"?module.exports=e():typeof define=="function"&&define.amd?define(e):(s=typeof globalThis<"u"?globalThis:s||self).TabsBroadcast=e()})(this,function(){"use strict";var L=Object.defineProperty;var _=s=>{throw TypeError(s)};var B=(s,e,r)=>e in s?L(s,e,{enumerable:!0,configurable:!0,writable:!0,value:r}):s[e]=r;var S=(s,e,r)=>B(s,typeof e!="symbol"?e+"":e,r),P=(s,e,r)=>e.has(s)||_("Cannot "+r);var a=(s,e,r)=>(P(s,e,"read from private field"),r?r.call(s):e.get(s)),c=(s,e,r)=>e.has(s)?_("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(s):e.set(s,r),m=(s,e,r,f)=>(P(s,e,"write to private field"),f?f.call(s,r):e.set(s,r),r),d=(s,e,r)=>(P(s,e,"access private method"),r);var T,g,v,w,p,h,n,l,C,O,u,k,x;const s={channelName:"xploit_tab_channel",layer:"default_layer",listenOwnChannel:!0,emitByPrimaryOnly:!0,onBecomePrimary:()=>{}},e={tab_prefix:"xploit_tab_id_",slave:"xploit_slave",primary:"xploit_primary",primaryTabId:"xploit_primary_tab_id",primaryStatusChanged:"XPLOIT_TAB_STATUS_CHANGED"};class r{constructor(){S(this,"tabId");this.tabId=e.tab_prefix+Date.now().toString(),this.init()}init(){if(typeof window>"u")return;const t=()=>{localStorage.getItem(e.primaryTabId)?this.setSlaveTab(this.tabId):this.setPrimaryTab(this.tabId),this.notifyTabStatus()};document.readyState==="complete"?t():window.addEventListener("load",t),window.addEventListener("pagehide",()=>{this.isPrimaryTab()&&(this.removeTabStatus(e.primaryTabId),this.transferPrimaryStatus()),this.removeTabStatus(this.tabId)}),window.addEventListener("storage",i=>{i.key===e.primaryTabId&&this.notifyTabStatus()})}set(t,i){localStorage.setItem(t,i)}get(t){return localStorage.getItem(t)}remove(t){localStorage.removeItem(t)}setPrimaryTab(t){this.set(e.primaryTabId,t),this.set(t,e.primary)}setSlaveTab(t){this.set(t,e.slave)}transferPrimaryStatus(){const t=Object.keys(localStorage).filter(i=>i!==e.primaryTabId&&this.get(i)===e.slave);t.length>0?this.setPrimaryTab(t.at(0)):this.remove(e.primaryTabId)}removeTabStatus(t){this.remove(t)}notifyTabStatus(){if(typeof window>"u")return;const t={detail:{tabId:this.tabId,isPrimary:this.isPrimaryTab()}};window.dispatchEvent(new CustomEvent(e.primaryStatusChanged,t))}isPrimaryTab(){return this.get(e.primaryTabId)===this.tabId}}const b=class b{constructor(t=null){c(this,l);c(this,T);c(this,g);c(this,v);c(this,w);c(this,p);c(this,h);c(this,n);S(this,"primary",!1);if(b.instance)return b.instance;this.setConfig(t),d(this,l,C).call(this),b.instance=this}on(t,i,o){d(this,l,u).call(this,o).listeners.push({type:t,callback:i})}onList(t){t.length&&t.forEach(([i,o,y])=>{i&&o&&d(this,l,u).call(this,y).listeners.push({type:i,callback:o})})}once(t,i,o){d(this,l,u).call(this,o).listeners.push({type:t,callback:i,once:!0})}onceList(t){t.length&&t.forEach(([i,o,y=s.layer])=>{i&&o&&d(this,l,u).call(this,y).listeners.push({type:i,callback:o,once:!0})})}off(t,i=null){if(i)a(this,n)[i].listeners.filter(o=>o.type!==t);else for(const o in a(this,n))a(this,n)[o].listeners.filter(y=>y.type!==t)}deleteLayer(t){d(this,l,u).call(this,t).listeners=[],a(this,n)[t]=null,delete a(this,n)[t]}emit(t,i=null,o=s.layer){if(a(this,w)&&!a(this,p).isPrimaryTab()||!a(this,h))return;const y={type:t,payload:i,layer:o};a(this,h).postMessage(y),a(this,g)&&a(this,h).onmessage({data:y})}isPrimary(){return a(this,p).isPrimaryTab()}setConfig(t){const i={...s,...t};m(this,T,i.channelName),m(this,n,{}),m(this,g,i.listenOwnChannel),m(this,v,i.onBecomePrimary),m(this,w,i.emitByPrimaryOnly)}destroy(){a(this,h)&&a(this,h).close(),b.instance=null,m(this,h,null)}getEvents(){return Object.keys(a(this,n)).length===1&&a(this,n)[s.layer]?[...a(this,n)[s.layer].listeners]:Object.values(a(this,n)).reduce((t,i)=>t=[...t,...i.listeners],[])}getLayers(){return Object.keys(a(this,n))}};T=new WeakMap,g=new WeakMap,v=new WeakMap,w=new WeakMap,p=new WeakMap,h=new WeakMap,n=new WeakMap,l=new WeakSet,C=function(){window&&(m(this,p,new r),m(this,h,new BroadcastChannel(a(this,T))),a(this,h).onmessage=d(this,l,k).bind(this),a(this,h).onmessageerror=d(this,l,x).bind(this),this.primary=!1,d(this,l,O).call(this))},O=function(){window.addEventListener(e.primaryStatusChanged,t=>{const i=t;a(this,p).isPrimaryTab()?(this.primary=!0,a(this,v).call(this,i.detail)):this.primary=!1},{passive:!0})},u=function(t=s.layer){return a(this,n)[t]||(a(this,n)[t]={name:t,listeners:[]}),a(this,n)[t]},k=function(t){const{type:i,payload:o,layer:y}=t.data,E=d(this,l,u).call(this,y);E.listeners=E.listeners.filter(I=>I.type!==i||(I.callback({type:i,payload:o,layer:y}),!I.once))},x=function(t){process.env.NODE_ENV!=="production"&&console.error("Can't parse message",t)},S(b,"instance");let f=b;return f});
//# sourceMappingURL=index.umd.js.map
