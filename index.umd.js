(function(s,e){typeof exports=="object"&&typeof module<"u"?module.exports=e():typeof define=="function"&&define.amd?define(e):(s=typeof globalThis<"u"?globalThis:s||self).TabsBroadcast=e()})(this,function(){"use strict";var C=Object.defineProperty;var _=(s,e,a)=>e in s?C(s,e,{enumerable:!0,configurable:!0,writable:!0,value:a}):s[e]=a;var v=(s,e,a)=>(_(s,typeof e!="symbol"?e+"":e,a),a),I=(s,e,a)=>{if(!e.has(s))throw TypeError("Cannot "+a)};var r=(s,e,a)=>(I(s,e,"read from private field"),a?a.call(s):e.get(s)),l=(s,e,a)=>{if(e.has(s))throw TypeError("Cannot add the same private member more than once");e instanceof WeakSet?e.add(s):e.set(s,a)},h=(s,e,a,y)=>(I(s,e,"write to private field"),y?y.call(s,a):e.set(s,a),a);var S=(s,e,a)=>(I(s,e,"access private method"),a);var n,m,p,b,u,f,o,g,P,T,E;const s={channelName:"xploit_tab_channel",listenOwnChannel:!0,emitByPrimaryOnly:!0,onBecomePrimary:()=>{}},e={tab_prefix:"xploit_tab_id_",slave:"xploit_slave",primary:"xploit_primary",primaryTabId:"xploit_primary_tab_id",primaryStatusChanged:"XPLOIT_TAB_STATUS_CHANGED"};class a{constructor(){v(this,"tabId");this.tabId=e.tab_prefix+Date.now().toString(),this.init()}init(){if(typeof window>"u")return;const t=()=>{localStorage.getItem(e.primaryTabId)?this.setSlaveTab(this.tabId):this.setPrimaryTab(this.tabId),this.notifyTabStatus()};window.addEventListener("load",t),window.addEventListener("beforeunload",()=>{this.isPrimaryTab()&&this.transferPrimaryStatus(),this.removeTabStatus(this.tabId)}),window.addEventListener("storage",i=>{i.key===e.primaryTabId&&this.notifyTabStatus()}),t()}set(t,i){localStorage.setItem(t,i)}get(t){return localStorage.getItem(t)}remove(t){localStorage.removeItem(t)}setPrimaryTab(t){this.set(e.primaryTabId,t),this.set(t,e.primary)}setSlaveTab(t){this.set(t,e.slave)}transferPrimaryStatus(){const t=Object.keys(localStorage).filter(i=>i!==e.primaryTabId&&this.get(i)===e.slave);t.length>0?this.setPrimaryTab(t[0]):this.remove(e.primaryTabId)}removeTabStatus(t){this.remove(t)}notifyTabStatus(){if(typeof window>"u")return;const t={detail:{tabId:this.tabId,isPrimary:this.isPrimaryTab()}};window.dispatchEvent(new CustomEvent(e.primaryStatusChanged,t))}isPrimaryTab(){return this.get(e.primaryTabId)===this.tabId}}const c=class c{constructor(t=null){l(this,g);l(this,T);l(this,n,void 0);l(this,m,void 0);l(this,p,void 0);l(this,b,void 0);l(this,u,void 0);l(this,f,void 0);l(this,o,void 0);if(c.instance)return c.instance;this.setConfig(t),S(this,g,P).call(this),c.instance=this}on(t,i){r(this,n).push({type:t,callback:i})}onList(t){t.length&&t.forEach(([i,d])=>{i&&d&&r(this,n).push({type:i,callback:d})})}once(t,i){r(this,n).push({type:t,callback:i,once:!0})}onceList(t){t.length&&t.forEach(([i,d])=>{i&&d&&r(this,n).push({type:i,callback:d,once:!0})})}off(t){h(this,n,r(this,n).filter(i=>i.type!==t))}emit(t,i=null){if(r(this,u)&&!this.isPrimary()||!r(this,o))return;const d={type:t,payload:i};r(this,o).postMessage(d),r(this,p)&&r(this,o).onmessage({data:d})}isPrimary(){return r(this,f).isPrimaryTab()}setConfig(t){const i={...s,...t};h(this,n,[]),h(this,m,i.channelName),h(this,p,i.listenOwnChannel),h(this,b,i.onBecomePrimary),h(this,u,i.emitByPrimaryOnly)}destroy(){r(this,o)&&r(this,o).close(),c.instance=null,h(this,o,null)}getEvents(){return[...r(this,n)]}};n=new WeakMap,m=new WeakMap,p=new WeakMap,b=new WeakMap,u=new WeakMap,f=new WeakMap,o=new WeakMap,g=new WeakSet,P=function(){window&&(h(this,f,new a),h(this,o,new BroadcastChannel(r(this,m))),r(this,o).onmessage=t=>{const{type:i,payload:d}=t.data;h(this,n,r(this,n).filter(w=>w.type!==i||(w.callback(t.data),!w.once)))},r(this,o).onmessageerror=t=>{process.env.NODE_ENV!=="production"&&console.error("Can't parse message",t)},S(this,T,E).call(this))},T=new WeakSet,E=function(){window.addEventListener(e.primaryStatusChanged,t=>{const i=t;this.isPrimary()&&r(this,b).call(this,i.detail)},{passive:!0})},v(c,"instance");let y=c;return y});
//# sourceMappingURL=index.umd.js.map
